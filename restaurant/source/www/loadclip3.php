<?php

include_once("data.php");

// 配列でアクションスクリプトを記述（URLやuidの引き渡しで使用する）
$as = array(
		"/:onload"    => "1"
		);

// それぞれのテンプレート

// [null]
$file[1] = $boil1;
$file[2] = $mix2;
$file[3] = $saute1;
$file[4] = $y13;
$file[5] = null;
$file[6] = $y1;

$head = "\x46\x57\x53\x04\x18\x05\x00\x00\x70\x00\x09\x60\x00\x00\x96\x00\x00\x0C\x01\x00\x43\x02\xFF\xFF\xFF";

$f1 = isset($file[1]) ? "\xBF\x05" .$file[1][0]. "\x00\x00\x01\x00" .$file[1][1]. "\xFF\x09\x10\x00\x00\x00\x02\x00\x01\x00\x86\x06\x06\x01\x00\x01\x00\x00\x40\x00\x00\x00\xBF\x06\x11\x00\x00\x00\x26\x03\x00\x02\x00\xC1\xF0\x7D\xF0\x7C\xB3\xFC\xF2\x80\x6D\x31\x00" : "";

$f2 = isset($file[2]) ? "\xBF\x05" .$file[2][0]. "\x00\x00\x03\x00" .$file[2][1]. "\xFF\x09\x10\x00\x00\x00\x04\x00\x01\x00\x86\x06\x06\x01\x00\x03\x00\x00\x40\x00\x00\x00\xBF\x06\x11\x00\x00\x00\x26\x05\x00\x04\x00\xC1\xF0\x7D\xF0\x7C\xD4\x0B\x0F\x28\x6D\x32\x00" : "";

$f3 = isset($file[3]) ? "\xBF\x05" .$file[3][0]. "\x00\x00\x05\x00" .$file[3][1]. "\xFF\x09\x10\x00\x00\x00\x06\x00\x01\x00\x86\x06\x06\x01\x00\x05\x00\x00\x40\x00\x00\x00\xBF\x06\x11\x00\x00\x00\x26\x07\x00\x06\x00\xC1\xF0\x7D\xF0\x7C\xD7\x17\x0F\x28\x6D\x33\x00" : "";

$f4 = isset($file[4]) ? "\xBF\x05" .$file[4][0]. "\x00\x00\x07\x00" .$file[4][1]. "\xFF\x09\x10\x00\x00\x00\x08\x00\x01\x00\x86\x06\x06\x01\x00\x07\x00\x00\x40\x00\x00\x00\xBF\x06\x11\x00\x00\x00\x26\x09\x00\x08\x00\xC1\xF0\x7D\xF0\x7C\xD0\xFF\x22\x10\x6D\x34\x00" : "";

$f5 = isset($file[5]) ? "\xBF\x05" .$file[5][0]. "\x00\x00\x09\x00" .$file[5][1]. "\xFF\x09\x10\x00\x00\x00\x0A\x00\x01\x00\x86\x06\x06\x01\x00\x09\x00\x00\x40\x00\x00\x00\xBF\x06\x11\x00\x00\x00\x26\x0B\x00\x0A\x00\xC1\xF0\x7D\xF0\x7C\xD4\x0B\x22\x10\x6D\x35\x00" : "";

$f6 = isset($file[6]) ? "\xBF\x05" .$file[6][0]. "\x00\x00\x0B\x00" .$file[6][1]. "\xFF\x09\x10\x00\x00\x00\x0C\x00\x01\x00\x86\x06\x06\x01\x00\x0B\x00\x00\x40\x00\x00\x00\xBF\x06\x11\x00\x00\x00\x26\x0D\x00\x0C\x00\xC1\xF0\x7D\xF0\x7C\xD7\x17\x22\x10\x6D\x36\x00" : "";

$foot = "\xBF\x05\x1A\x00\x00\x00\x0D\x00\x48\x01\x90\x00\x64\x00\x01\x00\xD7\x82\x10\x00\x10\x13\xB8\xC8\xDD\x64\x6E\x4E\x37\x67\x00\x00" . "\xFF\x09\x10\x00\x00\x00\x0E\x00\x01\x00\x86\x06\x06\x01\x00\x0D\x00\x00\x40\x00\x00\x00\xBF\x06\x10\x00\x00\x00\x26\x01\x00\x0E\x00\x1D\xCE\x02\x5F\x80\x70\x61\x72\x61\x6D\x00\x40\x00";

$source = $head . $f1 . $f2 . $f3 . $f4 . $f5 . $f6 . $foot;

header("Content-Type: application/x-shockwave-flash");

echo swf_wrapper($source,$as);

function swf_wrapper($src,$item){
	$tags	= build_tags($item);
	$i	= (ord($src[8])>>1)+5;
	$length	= ceil((((8-($i&7))&7)+$i)/8)+17;
	$head	= substr($src,0,$length);
	return(
		substr($head,0,4).
		pack("V",strlen($src)+strlen($tags)).
		substr($head,8).
		$tags.
		substr($src,$length)
	);
}

function build_tags($item){
	$tags = array();
	foreach($item as $k => $v){
		//$v = mb_convert_encoding($v,'SJIS','UTF-8');
		array_push( $tags, sprintf(
			"\x96%s\x00%s\x00\x96%s\x00%s\x00\x1d",
			pack("v",strlen($k)+2),	$k,
			pack("v",strlen($v)+2),	$v
		));
	}
	$s = implode('',$tags);
	return(sprintf(
		"\x3f\x03%s%s\x00",
		pack("V",strlen($s)+1),
		$s
	));
}

?>